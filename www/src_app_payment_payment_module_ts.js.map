{"version":3,"file":"src_app_payment_payment_module_ts.js","mappings":"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","sources":["./src/app/payment/payment-routing.module.ts","./src/app/payment/payment.module.ts","./src/app/payment/payment.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { Payment } from './payment';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: Payment\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PaymentRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { PaymentRoutingModule } from './payment-routing.module';\n\nimport { Payment } from './payment';\nimport { SharedModule } from '../shared/shared.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    PaymentRoutingModule,\n    SharedModule,\n  ],\n  declarations: [Payment]\n})\nexport class PaymentModule {}\n","import { Component, OnInit } from '@angular/core';\r\nimport { UntypedFormControl, UntypedFormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { NavController } from '@ionic/angular';\r\nimport { NgbModal } from '@ng-bootstrap/ng-bootstrap';\r\nimport { NgbdModalFocus } from '../modal/modal-focus';\r\nimport { Chantier } from '../models/chantier';\r\nimport { Facture } from '../models/facture';\r\nimport { StorageService } from '../services/storage.service';\r\n\r\n@Component({\r\n  selector: 'app-payment',\r\n  templateUrl: './payment.html',\r\n  styleUrls: ['./payment.scss'],\r\n})\r\nexport class Payment implements OnInit {\r\n  devise = '';\r\n  date : string;\r\n  chantier : Chantier;\r\n  chantierList : Array<Chantier>;\r\n  chantierIndex : number;\r\n  chantierId : string;\r\n  public selectedInv : Facture;\r\n  ReceivedMoney : number;\r\n  numericNumberReg= '^-?[0-9]\\\\d*(\\\\.\\\\d{1,2})?$';\r\n  formPay = new UntypedFormGroup({\r\n   chantierName: new UntypedFormControl(''),\r\n   payment: new UntypedFormControl('',Validators.pattern(this.numericNumberReg)),\r\n   address : new UntypedFormControl(''),\r\n });\r\n\r\n  headElementsInv = ['Nom facture', 'Total','Reste à payer','Date'];\r\n  public modal = new NgbdModalFocus(this.modalS);\r\n  constructor(private modalS :NgbModal,private router: Router,private route:ActivatedRoute, private storageService :StorageService\r\n    , private navController : NavController)\r\n  {\r\n  }\r\n\r\n  async ngOnInit() {\r\n\r\n    const nowDate = new Date();\r\n    this.date = nowDate.getDate()+'/'+(nowDate.getMonth()+1)+'/'+nowDate.getFullYear();\r\n\r\n    this.chantierId = this.route.snapshot.paramMap.get('chantierId');\r\n\r\n    this.storageService.init();\r\n    this.devise = await this.storageService.get('devise');\r\n    if(this.devise == null)\r\n      this.devise = '';\r\n    this.chantierList = await this.storageService.get('Chantiers');\r\n    this.chantierIndex = this.chantierList.findIndex(a => a.chantierId === this.chantierId);\r\n    this.chantier = this.chantierList.find(a => a.chantierId === this.chantierId);\r\n    // console.log(this.invList);\r\n  }\r\n  SelectInvoice(f : Facture)\r\n  {\r\n    this.selectedInv=f;\r\n    if(this.selectedInv.receivedMoney==null)\r\n      this.selectedInv.receivedMoney = new Array<{price : number,date : string}>();\r\n\r\n    this.ReceivedMoney=0;\r\n    this.selectedInv.receivedMoney.forEach(element => {\r\n      this.ReceivedMoney=element.price+this.ReceivedMoney;\r\n    });\r\n  }\r\n  public GetAllReceivedMoney(f : Facture) : number\r\n  {\r\n      let total= 0;\r\n      if(f.receivedMoney==null)\r\n        f.receivedMoney = new Array<{price: number, date : string}>();\r\n\r\n      f.receivedMoney.forEach(element => {\r\n          if(element.price.toString().includes(',') === true)\r\n          {\r\n            const price = element.price.toString().replace(',','.');\r\n            element.price = Number.parseFloat(price);\r\n          }\r\n          total=element.price+total;\r\n      });\r\n\r\n      total = Math.round(total * 100) / 100; // arrondi\r\n      return total;\r\n  }\r\n  GoBack()\r\n  {\r\n    this.navController.navigateBack(['worksite',{chantierId: this.chantierId}],{replaceUrl:true});\r\n  }\r\n  async SavePay()\r\n  {\r\n    const invalid = [];\r\n    const controls = this.formPay.controls;\r\n    for (const name in controls) {\r\n      if (controls[name].invalid) {\r\n          let nom='';\r\n          if(name==='payment')\r\n            nom='Paiement';\r\n          invalid.push(nom);\r\n      }\r\n    }\r\n    if(this.selectedInv==null)\r\n      invalid.push('Facture non selectionné');\r\n    if (!this.formPay.valid || this.selectedInv==null)\r\n    {\r\n      let res : string =null;\r\n      await this.modal.open('field',invalid.toString())\r\n      .then(result => result.result\r\n        .then((data) => {\r\n          res='OK';\r\n        }, (reason) => {\r\n        res='DISMISS' }\r\n        ));\r\n        return;\r\n    }\r\n\r\n    var payString : string = this.formPay.get('payment').value;\r\n    if(payString.toString().includes(',') === true)\r\n    {\r\n      payString.toString().replace(',','.');\r\n    }\r\n    var pay : number = Number.parseFloat(payString);\r\n    console.log(\"payString : \",payString);\r\n    console.log(\"pay : \",pay);\r\n    if(pay==null)\r\n      return;\r\n    if(this.selectedInv==null)\r\n      return;\r\n\r\n    if (pay>(this.selectedInv?.totalPrice - this.GetAllReceivedMoney(this.selectedInv)))\r\n    {\r\n      let res : string =null;\r\n      await this.modal.open('field','Argent encodé plus grand que le reste à payer')\r\n      .then(result => result.result\r\n        .then((data) => {\r\n          res='OK';\r\n        }, (reason) => {\r\n        res='DISMISS' }\r\n        ));\r\n        return;\r\n    }\r\n    this.selectedInv.receivedMoney.push({price : pay,date : this.date});\r\n    const index= this.chantier.factures.findIndex(a => a.factureId === this.selectedInv.factureId);\r\n    this.chantier.factures[index] = this.selectedInv;\r\n\r\n    this.chantierList[this.chantierIndex] = this.chantier;\r\n\r\n    this.storageService.set('Chantiers', this.chantierList);\r\n\r\n\r\n  }\r\n  Terminer()\r\n  {\r\n    this.navController.navigateBack(['/worksite',{chantierId: this.chantierId}],{replaceUrl:true});\r\n\r\n  }\r\n\r\n}\r\n"],"names":["Component","UntypedFormControl","UntypedFormGroup","Validators","ActivatedRoute","Router","NavController","NgbModal","NgbdModalFocus","StorageService","Payment","constructor","modalS","router","route","storageService","navController","chantierName","payment","pattern","numericNumberReg","address","ngOnInit","nowDate","Date","date","getDate","getMonth","getFullYear","chantierId","snapshot","paramMap","get","init","devise","chantierList","chantierIndex","findIndex","a","chantier","find","SelectInvoice","f","selectedInv","receivedMoney","Array","ReceivedMoney","forEach","element","price","GetAllReceivedMoney","total","toString","includes","replace","Number","parseFloat","Math","round","GoBack","navigateBack","replaceUrl","SavePay","invalid","controls","formPay","name","nom","push","valid","res","modal","open","then","result","data","reason","payString","value","pay","console","log","totalPrice","index","factures","factureId","set","Terminer","selector","template"],"sourceRoot":"webpack:///"}