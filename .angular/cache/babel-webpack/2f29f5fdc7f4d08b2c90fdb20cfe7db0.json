{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/storage.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"ng-apexcharts\";\nimport * as i6 from \"@ngx-translate/core\";\nconst _c0 = [\"chart\"];\n\nfunction Client_th_68_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const head_r2 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", head_r2, \" \");\n  }\n}\n\nfunction Client_tr_70_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 16);\n    i0.ɵɵelementStart(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(11, \"td\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const el_r3 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(el_r3.worksiteName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.GetName());\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(el_r3.dateStart);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(el_r3.address);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(el_r3.isFinished);\n  }\n}\n\nexport let Client = /*#__PURE__*/(() => {\n  class Client {\n    constructor(storageService, router, route) {\n      this.storageService = storageService;\n      this.router = router;\n      this.route = route;\n      this.userId = '';\n      this.headElements = ['Nom chantier', 'Nom Client', 'Date début', 'Adresse', 'Etat'];\n      this.chartOptions = {\n        series: [{\n          name: 'Argent payé',\n          data: []\n        }, {\n          name: 'Total à payer',\n          data: []\n        }, {\n          name: 'Reste à payer',\n          data: []\n        }],\n        chart: {\n          type: 'bar',\n          height: 350\n        },\n        plotOptions: {\n          bar: {\n            horizontal: false,\n            columnWidth: '55%',\n            endingShape: 'rounded'\n          }\n        },\n        dataLabels: {\n          enabled: false\n        },\n        stroke: {\n          show: true,\n          width: 2,\n          colors: ['transparent']\n        },\n        xaxis: {\n          categories: [// 'Feb',\n            // 'Mar',\n            // 'Apr',\n            // 'May',\n            // 'Jun',\n            // 'Jul',\n            // 'Aug',\n            // 'Sep',\n            // 'Oct'\n          ]\n        },\n        yaxis: {\n          title: {\n            text: '€'\n          }\n        },\n        fill: {\n          opacity: 1\n        },\n        tooltip: {\n          y: {\n            formatter(val) {\n              return val + '€';\n            }\n\n          }\n        }\n      };\n    }\n\n    GetName() {\n      var name = '/';\n      if (this.client) name = this.client.lastName.toUpperCase() + ' ' + this.client.firstName;\n      return name;\n    }\n\n    ionViewDidEnter() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.userId = this.route.snapshot.paramMap.get('userId');\n        this.storageService.init();\n        let clients = yield this.storageService.get('Contacts');\n        this.client = clients.find(a => a.userId == this.userId);\n        let chantiers = yield this.storageService.get('Chantiers');\n        this.chantiers = chantiers.filter(a => a.clientId === this.client.userId);\n        let i = 0;\n        this.chantiers.forEach(element => {\n          var _a;\n\n          for (let index = 0; index < ((_a = element.factures) === null || _a === void 0 ? void 0 : _a.length); index++) {\n            this.chartOptions.xaxis.categories[i] = element.factures[index].factureName;\n            this.chartOptions.series[1].data[i] = element.factures[index].totalPrice;\n            this.chartOptions.series[0].data[i] = this.GetAllReceivedMoney(element.factures[index]);\n            this.chartOptions.series[2].data[i] = element.factures[index].totalPrice - this.GetAllReceivedMoney(element.factures[index]);\n            i++;\n          }\n        });\n        console.log(this.chartOptions.xaxis.categories);\n      });\n    }\n\n    ngOnInit() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.userId = this.route.snapshot.paramMap.get('userId');\n        this.storageService.init();\n        let clients = yield this.storageService.get('Contacts');\n        this.client = clients.find(a => a.userId == this.userId);\n        let chantiers = yield this.storageService.get('Chantiers');\n        this.chantiers = chantiers.filter(a => a.clientId === this.client.userId);\n        let i = 0;\n        this.chantiers.forEach(element => {\n          var _a;\n\n          for (let index = 0; index < ((_a = element.factures) === null || _a === void 0 ? void 0 : _a.length); index++) {\n            this.chartOptions.xaxis.categories[i] = element.factures[index].factureName;\n            this.chartOptions.series[1].data[i] = element.factures[index].totalPrice;\n            this.chartOptions.series[0].data[i] = this.GetAllReceivedMoney(element.factures[index]);\n            this.chartOptions.series[2].data[i] = element.factures[index].totalPrice - this.GetAllReceivedMoney(element.factures[index]);\n            i++;\n          }\n        });\n        console.log(this.chartOptions.xaxis.categories);\n      });\n    }\n\n    GetAllReceivedMoney(f) {\n      let total = 0;\n      if (f.receivedMoney == null) f.receivedMoney = new Array();\n      f.receivedMoney.forEach(element => {\n        total = element.price + total;\n      });\n      total = Math.round(total * 100) / 100; // arrondi\n\n      return total;\n    }\n\n    EditContact() {\n      this.router.navigate(['new-contact', {\n        userId: this.client.userId,\n        tag: 'profile'\n      }]);\n      console.log('click', this.client.firstName);\n    }\n\n    GoBack() {\n      this.router.navigate(['tb-contacts'], {\n        replaceUrl: true\n      });\n    }\n\n  }\n\n  Client.ɵfac = function Client_Factory(t) {\n    return new (t || Client)(i0.ɵɵdirectiveInject(i1.StorageService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n  };\n\n  Client.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: Client,\n    selectors: [[\"app-client\"]],\n    viewQuery: function Client_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chart = _t.first);\n      }\n    },\n    decls: 77,\n    vars: 55,\n    consts: [[\"slot\", \"start\", 3, \"click\"], [\"name\", \"arrow-back\"], [\"slot\", \"end\", 3, \"click\"], [\"name\", \"pencil-outline\"], [\"slot\", \"\"], [3, \"fullscreen\"], [1, \"card-header\"], [\"position\", \"fixed\", 2, \"font-weight\", \"lighter\"], [2, \"font-weight\", \"bolder\"], [1, \"col-auto\", \"table-wrapper-scroll-y\", \"my-custom-scrollbar\"], [\"mat-table\", \"\", 1, \"table\", \"table-bordered\", \"table-striped\", \"mb-0\"], [\"scope\", \"col\", 4, \"ngFor\", \"ngForOf\"], [\"mdbTableCol\", \"\", 4, \"ngFor\", \"ngForOf\"], [\"id\", \"chart\"], [3, \"series\", \"chart\", \"dataLabels\", \"plotOptions\", \"yaxis\", \"legend\", \"fill\", \"stroke\", \"tooltip\", \"xaxis\"], [\"scope\", \"col\"], [\"mdbTableCol\", \"\"]],\n    template: function Client_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\");\n        i0.ɵɵelementStart(1, \"ion-toolbar\");\n        i0.ɵɵelementStart(2, \"ion-button\", 0);\n        i0.ɵɵlistener(\"click\", function Client_Template_ion_button_click_2_listener() {\n          return ctx.GoBack();\n        });\n        i0.ɵɵelement(3, \"ion-icon\", 1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-button\", 2);\n        i0.ɵɵlistener(\"click\", function Client_Template_ion_button_click_4_listener() {\n          return ctx.EditContact();\n        });\n        i0.ɵɵelement(5, \"ion-icon\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"ion-title\", 4);\n        i0.ɵɵtext(7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"ion-content\", 5);\n        i0.ɵɵelementStart(9, \"div\", 6);\n        i0.ɵɵtext(10);\n        i0.ɵɵpipe(11, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"ion-item\");\n        i0.ɵɵelementStart(13, \"ion-label\", 7);\n        i0.ɵɵtext(14);\n        i0.ɵɵpipe(15, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"ion-label\", 8);\n        i0.ɵɵtext(17);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"ion-item\");\n        i0.ɵɵelementStart(19, \"ion-label\", 7);\n        i0.ɵɵtext(20);\n        i0.ɵɵpipe(21, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"ion-label\", 8);\n        i0.ɵɵtext(23);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"ion-item\");\n        i0.ɵɵelementStart(25, \"ion-label\", 7);\n        i0.ɵɵtext(26);\n        i0.ɵɵpipe(27, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"ion-label\", 8);\n        i0.ɵɵtext(29);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"ion-item\");\n        i0.ɵɵelementStart(31, \"ion-label\", 7);\n        i0.ɵɵtext(32);\n        i0.ɵɵpipe(33, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(34, \"ion-label\", 8);\n        i0.ɵɵtext(35);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"ion-item\");\n        i0.ɵɵelementStart(37, \"ion-label\", 7);\n        i0.ɵɵtext(38);\n        i0.ɵɵpipe(39, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(40, \"ion-label\", 8);\n        i0.ɵɵtext(41);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(42, \"ion-item\");\n        i0.ɵɵelementStart(43, \"ion-label\", 7);\n        i0.ɵɵtext(44);\n        i0.ɵɵpipe(45, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(46, \"ion-label\", 8);\n        i0.ɵɵtext(47);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(48, \"ion-item\");\n        i0.ɵɵelementStart(49, \"ion-label\", 7);\n        i0.ɵɵtext(50);\n        i0.ɵɵpipe(51, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(52, \"ion-label\", 8);\n        i0.ɵɵtext(53);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(54, \"ion-item\");\n        i0.ɵɵelementStart(55, \"ion-label\", 7);\n        i0.ɵɵtext(56);\n        i0.ɵɵpipe(57, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(58, \"ion-label\", 8);\n        i0.ɵɵtext(59);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(60, \"hr\");\n        i0.ɵɵelementStart(61, \"div\", 6);\n        i0.ɵɵtext(62);\n        i0.ɵɵpipe(63, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(64, \"div\", 9);\n        i0.ɵɵelementStart(65, \"table\", 10);\n        i0.ɵɵelementStart(66, \"thead\");\n        i0.ɵɵelementStart(67, \"tr\");\n        i0.ɵɵtemplate(68, Client_th_68_Template, 2, 1, \"th\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(69, \"tbody\");\n        i0.ɵɵtemplate(70, Client_tr_70_Template, 12, 5, \"tr\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(71, \"hr\");\n        i0.ɵɵelementStart(72, \"div\", 6);\n        i0.ɵɵtext(73);\n        i0.ɵɵpipe(74, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(75, \"div\", 13);\n        i0.ɵɵelement(76, \"apx-chart\", 14);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate1(\"Client : \", ctx.GetName(), \"\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"fullscreen\", true);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(11, 33, \"profile\"), \" \");\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(15, 35, \"fName\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.firstName);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(21, 37, \"name\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.lastName.toUpperCase());\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(27, 39, \"address\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.address);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(33, 41, \"phone\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.phone);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(39, 43, \"mail\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.mail);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(45, 45, \"tva\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.tva);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(51, 47, \"iban\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.iban);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(57, 49, \"bic\"), \" : \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.client == null ? null : ctx.client.bic);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(63, 51, \"history\"), \" \");\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.headElements);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.chantiers);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(74, 53, \"achats\"), \" \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"series\", ctx.chartOptions.series)(\"chart\", ctx.chartOptions.chart)(\"dataLabels\", ctx.chartOptions.dataLabels)(\"plotOptions\", ctx.chartOptions.plotOptions)(\"yaxis\", ctx.chartOptions.yaxis)(\"legend\", ctx.chartOptions.legend)(\"fill\", ctx.chartOptions.fill)(\"stroke\", ctx.chartOptions.stroke)(\"tooltip\", ctx.chartOptions.tooltip)(\"xaxis\", ctx.chartOptions.xaxis);\n      }\n    },\n    directives: [i3.IonHeader, i3.IonToolbar, i3.IonButton, i3.IonIcon, i3.IonTitle, i3.IonContent, i3.IonItem, i3.IonLabel, i4.NgForOf, i5.ChartComponent],\n    pipes: [i6.TranslatePipe],\n    styles: [\"#chart[_ngcontent-%COMP%]{max-width:650px;margin:35px auto}fieldset[_ngcontent-%COMP%]{border:0}fieldset.display[_ngcontent-%COMP%]{border:1px solid #cccccc}\"]\n  });\n  return Client;\n})();","map":null,"metadata":{},"sourceType":"module"}