{"version":3,"file":"src_app_hours_hours_module_ts.js","mappings":"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","sources":["./src/app/hours/hours-routing.module.ts","./src/app/hours/hours.module.ts","./src/app/hours/hours.ts","./src/app/models/hour.ts","./src/app/hours/hours.html"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { Hours } from './hours';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: Hours\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class HoursRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { HoursRoutingModule } from './hours-routing.module';\n\nimport { Hours } from './hours';\nimport { SharedModule } from '../shared/shared.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    HoursRoutingModule,\n    SharedModule\n  ],\n  declarations: [Hours]\n})\nexport class HoursModule {}\n","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { NgbModal } from '@ng-bootstrap/ng-bootstrap';\r\nimport { UUID } from 'angular2-uuid';\r\nimport { SSL_OP_SSLEAY_080_CLIENT_DH_BUG } from 'constants';\r\nimport { NgbdModalFocus } from '../modal/modal-focus';\r\nimport { Chantier } from '../models/chantier';\r\nimport { Hour } from '../models/hour';\r\nimport { StorageService } from '../services/storage.service';\r\n\r\n@Component({\r\n  selector: 'app-hours',\r\n  templateUrl: './hours.html',\r\n  styleUrls: ['./hours.scss'],\r\n})\r\nexport class Hours implements OnInit {\r\n\r\n  formHour = new FormGroup({\r\n    date: new FormControl('',Validators.required),\r\n    description: new FormControl(''),\r\n  });\r\n  hour : Hour;\r\n  date : string;\r\n  hoursList : Array<Hour> =[];\r\n  uuidValue: string;\r\n  chantierId:string;\r\n  hourId: string;\r\n  indexFind: number;\r\n\r\n  public modal = new NgbdModalFocus(this.modalS);\r\n  constructor(private modalS :NgbModal,\r\n              public router:Router, \r\n              public storageService: StorageService,\r\n              public route:ActivatedRoute,\r\n              private cd : ChangeDetectorRef)\r\n  {\r\n  }\r\n  async ngOnInit(): Promise<void> {\r\n    const nowDate = new Date();\r\n    this.date = nowDate.getDate()+'/'+(nowDate.getMonth()+1)+'/'+nowDate.getFullYear();\r\n    this.chantierId = this.route.snapshot.paramMap.get('chantierId');\r\n\r\n    this.storageService.init();\r\n\r\n    const chantierl : Array<Chantier> = await this.storageService.get('Chantiers');\r\n    const chantier = chantierl.find(a => a.chantierId === this.chantierId);\r\n    this.hoursList =chantier.hours;\r\n    if(this.hoursList==null)\r\n      this.hoursList = new Array<Hour>();\r\n\r\n    const existId = this.route.snapshot.paramMap.get('hourId');\r\n    this.chantierId = this.route.snapshot.paramMap.get('chantierId');\r\n\r\n    if(existId!=null)\r\n    {\r\n      // console.log('modification',existId);\r\n      this.indexFind =this.hoursList.findIndex(x => x.hourId === existId);\r\n      if(this.indexFind>=0)\r\n      {\r\n        this.hourId=this.hoursList[this.indexFind].hourId;\r\n        this.hour = new Hour(\r\n          this.hoursList[this.indexFind].hourId,\r\n          this.hoursList[this.indexFind].date,\r\n          this.hoursList[this.indexFind].description,\r\n          this.hoursList[this.indexFind].hour,\r\n          this.hoursList[this.indexFind].minute,\r\n        )\r\n        const d = new Date();\r\n        // console.log(this.hour.hour, 'et ',this.hour.minute);\r\n        d.setUTCHours(this.hour.hour,this.hour.minute,0,0);\r\n        // d.setHours(this.hour.hour,this.hour.minute,0,0);\r\n        // let dd = new Date(d.toString());\r\n        // console.log(d.toLocaleDateString(),d.toTimeString(),d.toUTCString(),d.toLocaleTimeString());\r\n        console.log('dt',d.toISOString());\r\n        this.formHour.setValue({\r\n          date: d.toISOString(),\r\n          description:  this.hoursList[this.indexFind].description,\r\n        });\r\n        this.formHour.updateValueAndValidity();\r\n        console.log('opening Hours');\r\n        this.cd.detectChanges();\r\n        // this.cd.detectChanges();\r\n        // this.formHour.get('date').setValue(d.toISOString());\r\n        // this.formHour.patchValue({ date : d.toISOString()});\r\n      }\r\n    }else\r\n    {\r\n      console.log('creation',existId);\r\n      this.hourId= this.generateUUID();\r\n    }\r\n  }\r\n\r\n  public customFormatter(value: number) {\r\n    return `${value}%`\r\n  }\r\n  async CreateHour()\r\n  {\r\n    const invalid = [];\r\n    const controls = this.formHour.controls;\r\n    for (const name in controls) {\r\n      if (controls[name].invalid) {\r\n          let nom='';\r\n          if(name==='date')\r\n            nom='Heure';\r\n          invalid.push(nom);\r\n      }\r\n    }\r\n    if (!this.formHour.valid)\r\n    {\r\n      let res : string =null;\r\n      await this.modal.open('field',invalid.toString())\r\n      .then(result => result.result\r\n        .then((data) => {\r\n          res='OK';\r\n        }, (reason) => {\r\n        res='DISMISS' }\r\n        ));\r\n        return;\r\n    }\r\n\r\n      const dd = new Date(this.formHour.get('date').value);\r\n      console.log(dd.getHours(), ':',dd.getMinutes());\r\n\r\n\r\n      console.log(this.generateUUID());\r\n      console.log('form status',this.formHour);\r\n      if (!this.formHour.valid)\r\n        return;\r\n\r\n      this.hour = new Hour(\r\n        this.hourId,\r\n        this.date,\r\n        this.formHour.get('description').value,\r\n        dd.getHours(),\r\n        dd.getMinutes(),\r\n      );\r\n\r\n      if(this.indexFind>=0)\r\n      {\r\n        // this.hoursList.splice(this.indexFind,1);\r\n        this.hoursList[this.indexFind] = this.hour;\r\n      }else this.hoursList.push(this.hour);\r\n\r\n      const chantierl : Array<Chantier> = await this.storageService.get('Chantiers');\r\n      const chantier = chantierl.find(a => a.chantierId === this.chantierId);\r\n      const chantierIndex = chantierl.findIndex(a => a.chantierId === this.chantierId);\r\n\r\n      chantier.hours= this.hoursList;\r\n      chantierl[chantierIndex] = chantier;\r\n      this.storageService.set('Chantiers',chantierl);\r\n      // this.storageService.set('Hours='+this.chantierId,this.hoursList);\r\n      this.router.navigate(['/worksite',{chantierId: this.chantierId}],{replaceUrl:true});\r\n    }\r\n    generateUUID()\r\n    {\r\n        this.uuidValue=UUID.UUID();\r\n        return this.uuidValue;\r\n    }\r\n    GoBack()\r\n    {\r\n      this.router.navigate(['/worksite',{chantierId: this.chantierId}],{replaceUrl:true});\r\n    }\r\n}\r\n","export interface IHour\r\n{\r\n    hourId:string;\r\n    date : string;\r\n    description:string;\r\n    hour : number;\r\n    minute : number;\r\n    workTime: string;\r\n}\r\n\r\nexport class Hour implements IHour {\r\n    public workTime : string;\r\n    constructor(\r\n        public hourId:string,\r\n        public date : string,\r\n        public description:string,\r\n        public hour : number,\r\n        public minute : number,\r\n    ) \r\n    {\r\n        this.workTime = hour.toString() + 'h'+minute.toString();\r\n    }\r\n\r\n  }","export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-button (click)=\\\"GoBack()\\\">\\n      <ion-icon name=\\\"arrow-back\\\"></ion-icon>\\n      <ion-label>Retour</ion-label>\\n    </ion-button>\\n  </ion-toolbar>\\n</ion-header>\\n<div class=\\\"container\\\">\\n  <form [formGroup]=\\\"formHour\\\" (ngSubmit)=\\\"CreateHour()\\\">\\n\\n    <ion-datetime formControlName=\\\"date\\\" presentation=\\\"time\\\"></ion-datetime>\\n\\n    <hr>\\n    <ion-item>\\n      <ion-label position=\\\"floating\\\">Description</ion-label>\\n      <ion-textarea id=\\\"description\\\" name=\\\"description\\\" formControlName=\\\"description\\\" placeholder=\\\"...\\\"\\n        style=\\\"height:100px;\\\"></ion-textarea>\\n    </ion-item>\\n\\n    <input type=\\\"submit\\\" value=\\\"Ajouter prÃ©station\\\">\\n  </form>\\n</div>\";"],"names":[],"sourceRoot":"webpack:///"}